Vue.component("a2-mdi-header",{template:`
<div class="mdi-header">
	<span v-text=title></span>
	<div class="aligner"></div>
	<slot></slot>
</div>
	`,props:{title:String,subTitle:String},mounted(){console.dir("header mounted");console.dir(this.title)}}),function(){const t=require("std:popup"),n=require("std:eventBus");Vue.component("a2-mdi-navbar",{template:`
<div class="mdi-navbar">
	<ul class="bar">
		<li v-for="m in menu" @click.stop.prevent=clickMenu(m) :title=m.Name>
			<i class="ico" :class="menuIcon(m)"></i>
		</li>
	</ul>
	<div class="mdi-menu" v-if="isMenuVisible">
		<ul>
			<li v-for="m in activeMenu.Menu" class="level-0">
				<span class="folder" v-text="m.Name"></span>
				<ul v-if="!!m.Menu">
					<li v-for="im in m.Menu" class="level-1" @click.stop.prevent="clickSubMenu(im)" v-text="im.Name">
					</li>
				</ul>
			</li>
		</ul>
	</div>
</div>
	`,props:{menu:Array},data(){return{activeMenu:null,popupVisible:!1}},computed:{isMenuVisible(){return!!this.activeMenu&&this.popupVisible}},methods:{clickMenu(t){n.$emit("closeAllPopups");const i=this.$parent;t.Menu?this.activeMenu===t&&this.popupVisible?this.popupVisible=!1:(this.popupVisible=!0,this.activeMenu=t):(this.popupVisible=!1,i.$emit("navigate",{title:t.Name,url:t.Url}))},clickSubMenu(t){n.$emit("closeAllPopups");const i=this.$parent;this.popupVisible=!1;i.$emit("navigate",{title:t.Name,url:t.Url})},menuIcon(n){return"ico-"+n.Icon},__clickOutside(){this.popupVisible=!1}},mounted(){t.registerPopup(this.$el);this.$el._close=this.__clickOutside}})}(),function(){const n=require("std:eventBus"),t=require("std:popup"),f=require("std:utils"),r=require("std:url"),u=require("std:log"),e=component("std:modal"),o=component("std:toastr");let i=77;app.components["std:shellPlain"]=Vue.extend({data(){return{tabs:[],closedTabs:[],activeTab:null,modals:[],modalRequeryUrl:"",traceEnabled:u.traceEnabled(),debugShowTrace:!1,debugShowModel:!1,dataCounter:0,sidePaneUrl:"",tabPopupOpen:!1,navigatingUrl:"",lockRoute:!1}},components:{"a2-modal":e,"a2-toastr":o},computed:{modelStack(){return this.__dataStack__},hasModals(){return this.modals.length>0},sidePaneVisible(){return!!this.sidePaneUrl},storageKey(){return this.appData.appId+"_tabs"}},methods:{navigate(n){let t=this.tabs.find(t=>t.url==n.url);if(!t){let u="";this.activeTab&&(u=this.activeTab.url||"");t={title:n.title,url:n.url,loaded:!0,key:i++,root:null,parentUrl:u};this.tabs.push(t);var r=this.closedTabs.findIndex(t=>t.url===n.url);r>=0&&this.closedTabs.splice(r,1)}t.loaded=!0;this.activeTab=t;this.tabs.length>10&&this.tabs.splice(0,1);this.storeTabs()},navigateTo(n){this.navigatingUrl=n.url;this.navigate({url:n.url,title:""})},setDocTitle(n){let t=this.activeTab;!t&&this.navigatingUrl&&(t=this.tabs.find(n=>n.url===this.navigatingUrl));t&&(t.title=n)},setNewId(n){let t=this.tabs.find(t=>t.url===n.from);t&&(this.lockRoute=!0,t.url=n.to,t.root&&(t.root.__tabUrl__=t.url),Vue.nextTick(()=>{this.lockRoute=!1}),this.storeTabs())},tabLoadComplete(n){if(n){let t=this.tabs.find(t=>t.url==n.src);t.root=n.root;n.root&&(n.root.__tabUrl__=t.url,n.root.$store.commit("setroute",t.url))}this.navigatingUrl=""},isTabActive(n){return n===this.activeTab},tabSource(n){return n.loaded?n.url:null},selectTab(n,t){(this.tabPopupOpen=!1,n.loaded=!0,this.activeTab=n,t)||this.storeTabs()},reopenTab(n){this.tabPopupOpen=!1;this.navigate(n);let t=this.closedTabs.indexOf(n);this.closedTabs.splice(t,1);this.storeTabs()},closeTabFromStore(n){if(n&&n.root){let i=n.root.__tabUrl__,t=this.tabs.findIndex(n=>n.url===i);t>=0&&this.removeTab(t)}},closeTab(n){this.tabPopupOpen=!1;let t=this.tabs.indexOf(n);t!=-1&&(n!==this.activeTab,n.root.$close?n.root.$close():this.removeTab(t))},removeTab(n){n>0?this.selectTab(this.tabs[n-1],!0):this.tabs.length>1?this.selectTab(this.tabs[n+1],!0):this.activeTab=null;let t=this.tabs.splice(n,1);t.length&&(this.closedTabs.unshift(t[0]),this.closedTabs.length>10&&this.closedTabs.pop());this.storeTabs()},storeTabs(){var n=n=>({title:n.title,url:n.url,parentUrl:n.parentUrl});let t=this.tabs.indexOf(this.activeTab),i=JSON.stringify({index:t,tabs:this.tabs.map(n),closedTabs:this.closedTabs.map(n)});window.localStorage.setItem(this.storageKey,i)},restoreTabs(){let n=window.localStorage.getItem(this.storageKey);if(n)try{let r=JSON.parse(n),t=r.index;t<0&&(t=0);for(let n=0;n<r.tabs.length;n++){let u=r.tabs[n],f=t===n;f&&(this.navigatingUrl=u.url);this.tabs.push({title:u.title,url:u.url,loaded:f,key:i++,root:null,parentUrl:u.parentUrl})}for(let n=0;n<r.closedTabs.length;n++){let t=r.closedTabs[n];this.closedTabs.push({title:t.title,url:t.url,loaded:!0,key:i++})}t>=0&&t<this.tabs.length&&(this.activeTab=this.tabs[t])}catch(t){}},toggleTabPopup(){n.$emit("closeAllPopups");this.tabPopupOpen=!this.tabPopupOpen},showModal(n,t){let u=f.getStringId(t?t.data:null),s=t&&t.raw,e=window.$$rootUrl,o=r.combine(e,"/_dialog",n,u);s&&(o=r.combine(e,n,u));let i={title:"dialog",url:o,prms:t.data,wrap:!1,rd:t.rd};i.promise=new Promise(function(n){i.resolve=n});t.promise=i.promise;this.modals.push(i);this.setupWrapper(i)},setupWrapper(n){this.modalRequeryUrl="";setTimeout(()=>{n.wrap=!0},50)},modalCreated(n){const i=()=>{for(let n=this.modals.length-1;n>=0;--n){let t=this.modals[n];if(t.rd)return t}return null};let t=i();t&&(t.instance=n)},_eventModalClose(n){if(this.modals.length){const i=this.modals[this.modals.length-1],t=n=>{let t=this.modals.pop();n&&t.resolve(n)};if(!i.attrs){t(n);return}if(i.attrs.alwaysOk&&(n=!0),i.attrs.canClose){let r=i.attrs.canClose();r===!0?t(n):r.then?n.then(function(i){i===!0?t(n):i&&t(i)}):r&&t(r)}else t(n)}},_eventModalCloseAll(){while(this.modals.length){let n=this.modals.pop();n.resolve(!1)}},_eventConfirm(n){let t=n.data;t.wrap=!1;t.promise=new Promise(function(n){t.resolve=n});n.promise=t.promise;this.modals.push(t);this.setupWrapper(t)},debugTrace(){window.$$debug&&(this.debugShowModel=!1,this.debugShowTrace=!this.debugShowTrace)},debugModel(){window.$$debug&&(this.debugShowTrace=!1,this.debugShowModel=!this.debugShowModel)},debugClose(){this.debugShowModel=!1;this.feedbackVisible=!1},registerData(n,t){this.dataCounter+=1;n?(this.__dataStack__.length>0&&(t.caller=this.__dataStack__[0]),this.__dataStack__.unshift(n),this.activeTab&&!n.inDialog&&(this.activeTab.root=n)):this.__dataStack__.length>1&&this.__dataStack__.shift()},updateModelStack(n){this.__dataStack__.length>0&&this.__dataStack__[0]===n||(this.__dataStack__.splice(0),this.__dataStack__.unshift(n),this.dataCounter+=1)},showSidePane(n){if(n){let t="/_page"+n;this.sidePaneUrl=this.sidePaneUrl===t?"":t}else this.sidePaneUrl=""},__clickOutside(){this.tabPopupOpen=!1}},watch:{traceEnabled(n){u.enableTrace(n)},activeTab(n){n&&n.root&&this.updateModelStack(n.root)}},mounted(){t.registerPopup(this.$el);this.$el._close=this.__clickOutside;this.restoreTabs()},created(){const i=this;i.__dataStack__=[];t.startService();this.$on("navigate",this.navigate);n.$on("navigateto",this.navigateTo);n.$on("setdoctitle",this.setDocTitle);n.$on("setnewid",this.setNewId);n.$on("closeAllPopups",t.closeAll);n.$on("modal",this.showModal);n.$on("modalCreated",this.modalCreated);n.$on("modalClose",this._eventModalClose);n.$on("modalCloseAll",this._eventModalCloseAll);n.$on("registerData",this.registerData);n.$on("showSidePane",this.showSidePane);n.$on("confirm",this._eventConfirm);n.$on("closePlain",this.closeTabFromStore)}})}();